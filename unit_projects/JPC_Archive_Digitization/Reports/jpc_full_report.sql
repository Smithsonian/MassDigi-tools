select jar.resource_id, jar.resource_title, jad.refid, jad.unit_title, jad.creation_date, jad.mod_date, count(distinct f.file_id) as no_images, count(distinct SUBSTRING_INDEX(f.file_name, '_', 2)) as no_items, count(distinct SUBSTRING_INDEX(f.file_name, '_', 1)) as no_folders FROM jpc_aspace_resources jar, jpc_aspace_data jad LEFT JOIN files f ON (jad.refid = SUBSTRING_INDEX(f.file_name, '_', 1)) LEFT JOIN folders fol ON (fol.folder_id = f.folder_id AND (fol.project_id = 201 or fol.project_id = 186 or fol.project_id = 220)) where jar.resource_id = jad.resource_id group by jar.resource_id, jar.resource_title, jad.refid, jad.unit_title, jad.creation_date, jad.mod_date ORDER BY jad.mod_date, jad.refid;
